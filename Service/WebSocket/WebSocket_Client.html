<html>

<head>
    <title>Web Socket client</title>
</head>
<script>
    var socket;
    // var M_Web_Socket_Url = "ws://10.3.1.243:80/portal/websocket?appName=MSG_PUSH&userId=0001Z8100000000LVJQQ";
    var M_Web_Socket_Url = "ws://172.18.44.177:80/portal/websocket?appName=MSG_PUSH&userId=1001Z81000000000K47Z";

    function Test() {
        if (typeof (WebSocket) == "undefined") {
            return false;
        }
        return true;
    }

    function ConnectE(url) {
        socket = new WebSocket(url);

        socket.onopen = function () {
            console.info("socket open!");
        }
        socket.onmessage = function (msg) {
            console.debug("Msg:" + msg.data);
        }
        socket.onclose = function () {
            console.info("socket close!");
            var checkbox_autoConnect = findElementById("checkbox_autoConnect");
            if (checkbox_autoConnect != undefined && checkbox_autoConnect != null) {
                var isChecked = checkbox_autoConnect.getAttribute("value");
                if (!isChecked) {
                    return;
                }
            }
            Connect();
        }
        socket.onerror = function () {
            console.error("socket error!");
        }
    }

    function Close() {
        if (socket != null) {
            socket.close();
        }
    }

    function send(msg) {
        if (socket != null) {
            socket.send(msg);
        }
    }

    function Connect() {
        var url = M_Web_Socket_Url;
        ConnectE(url);
    }

    function CheckStatus() {
        if (socket != null && socket != undefined) {
            var status = socket.readyState;
            var str;
            if (status == undefined) {
                str = "readyState: undefined";
            } else {

                switch (status) {
                    case 0:
                        str = "连接尚未建立";
                        break;
                    case 1:
                        str = "连接已建立";
                        break;
                    case 2:
                        str = "连接正在进行关闭";
                        break;
                    case 3:
                        str = "连接已经关闭或者连接不能打开";
                        break;
                    default:
                        str = "未知状态:" + status;
                        break;
                }
            }
            console.info("连接状态：" + str);
        }
    }

    function findElementById(id) {
        if (id == undefined || id == null || id == "") {
            return undefined;
        }
        var obj = document.getElementById(id);
        return obj;
    }
</script>
<style>
    button.ButtonSytle {
        background-color: whitesmoke;
        width: 60px;
        height: 60px;
    }

    .MainDivStyle {
        align-items: baseline;
        top: 5%;
        height: 15%;
        position: absolute;
        border-width: 1ch;
        border-color: red;
    }

    .ContentStyle {
        height: 70%;
        width: 100%;
        top: 20%;
        position: absolute;
        border-width: 1ch;
        border-color: red;
        background-color: gray;
        margin: 20px;
    }
</style>

<body>
    <!-- <form item-width="400">
        Url:
        <br>
        <input type="text" name="firstname" width="500">
    </form> -->
    <ul class="MainDivStyle">
        <li>
            <button onclick="Connect()">连接</button>
            <input type="checkbox" id="checkbox_autoConnect"> 是否自动连接</input>
        </li>
        <li>
            <button onclick="Close()">关闭</button>
        </li>
        <li>
            <button onclick="CheckStatus()">检测WebSocket状态</button>
        </li>
    </ul>
    <div name="contentDiv" class="ContentStyle">
        内容
    </div>


</html>